openapi: 3.0.3
info:
  description: >-
    Welcome to Cloudflare's API documentation site. We are experimenting with an
    updated version of our API documentation - check out
    [developers.cloudflare.com/api-next/](https://developers.cloudflare.com/api-next/)
    to test out the new experience.


    To get started using Cloudflare's products and services via the API, refer
    to [how to interact with
    Cloudflare](https://developers.cloudflare.com/fundamentals/basic-tasks/interact-with-cloudflare/),
    which covers using tools like
    [Terraform](https://developers.cloudflare.com/terraform/#cloudflare-terraform)
    and the [official
    SDKs](https://developers.cloudflare.com/fundamentals/api/reference/sdks/) to
    maintain your Cloudflare resources.


    Using the Cloudflare API requires authentication so that Cloudflare knows
    who is making requests and what permissions you have. Create an API token to
    grant access to the API to perform actions. You can also authenticate with
    [API
    keys](https://developers.cloudflare.com/fundamentals/api/get-started/keys/),
    but these keys have [several
    limitations](https://developers.cloudflare.com/fundamentals/api/get-started/keys/#limitations)
    that make them less secure than API tokens. Whenever possible, use API
    tokens to interact with the Cloudflare API.


    To create an API token, from the Cloudflare dashboard, go to My Profile >
    API Tokens and select Create Token. For more information on how to create
    and troubleshoot API tokens, refer to

    our [API fundamentals](https://developers.cloudflare.com/fundamentals/api/).


    For information regarding rate limits, refer to our [API Rate
    Limits](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/platform/limits/#api-rate-limits).


    Totally new to Cloudflare? [Start
    here](https://developers.cloudflare.com/fundamentals/get-started/).
  license:
    name: BSD-3-Clause
    url: https://opensource.org/licenses/BSD-3-Clause
  title: Cloudflare API
  version: 4.0.0
servers:
  - description: Client API
    url: https://api.cloudflare.com/client/v4
paths:
  /accounts/{account_id}/workers/observability/telemetry/query:
    post:
      description: Runs a temporary or saved query
      operationId: telemetry.query
      parameters:
        - description: Your Cloudflare account ID.
          in: path
          name: account_id
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              properties:
                chart:
                  type: boolean
                compare:
                  type: boolean
                dry:
                  default: false
                  type: boolean
                granularity:
                  type: number
                ignoreSeries:
                  default: false
                  type: boolean
                limit:
                  default: 50
                  maximum: 100
                  type: number
                offset:
                  type: string
                offsetBy:
                  type: number
                offsetDirection:
                  type: string
                parameters:
                  properties:
                    calculations:
                      description: Create Calculations to compute as part of the query.
                      items:
                        properties:
                          alias:
                            type: string
                          key:
                            type: string
                          keyType:
                            enum:
                              - string
                              - number
                              - boolean
                            type: string
                          operator:
                            enum:
                              - uniq
                              - count
                              - max
                              - min
                              - sum
                              - avg
                              - median
                              - p001
                              - p01
                              - p05
                              - p10
                              - p25
                              - p75
                              - p90
                              - p95
                              - p99
                              - p999
                              - stddev
                              - variance
                              - COUNT_DISTINCT
                              - COUNT
                              - MAX
                              - MIN
                              - SUM
                              - AVG
                              - MEDIAN
                              - P001
                              - P01
                              - P05
                              - P10
                              - P25
                              - P75
                              - P90
                              - P95
                              - P99
                              - P999
                              - STDDEV
                              - VARIANCE
                            type: string
                        required:
                          - operator
                        type: object
                      type: array
                    datasets:
                      description: >-
                        Set the Datasets to query. Leave it empty to query all
                        the datasets.
                      example: []
                      items:
                        type: string
                      type: array
                    filterCombination:
                      description: >-
                        Set a Flag to describe how to combine the filters on the
                        query.
                      enum:
                        - and
                        - or
                        - AND
                        - OR
                      type: string
                    filters:
                      description: Configure the Filters to apply to the query.
                      items:
                        properties:
                          key:
                            type: string
                          operation:
                            enum:
                              - includes
                              - not_includes
                              - starts_with
                              - regex
                              - exists
                              - is_null
                              - in
                              - not_in
                              - eq
                              - neq
                              - gt
                              - gte
                              - lt
                              - lte
                              - '='
                              - '!='
                              - '>'
                              - '>='
                              - <
                              - <=
                              - INCLUDES
                              - DOES_NOT_INCLUDE
                              - MATCH_REGEX
                              - EXISTS
                              - DOES_NOT_EXIST
                              - IN
                              - NOT_IN
                              - STARTS_WITH
                            type: string
                          type:
                            enum:
                              - string
                              - number
                              - boolean
                            type: string
                          value:
                            anyOf:
                              - type: string
                              - type: number
                              - type: boolean
                        required:
                          - key
                          - operation
                          - type
                        type: object
                      type: array
                    groupBys:
                      description: Define how to group the results of the query.
                      items:
                        properties:
                          type:
                            enum:
                              - string
                              - number
                              - boolean
                            type: string
                          value:
                            type: string
                        required:
                          - type
                          - value
                        type: object
                      type: array
                    havings:
                      description: >-
                        Configure the Having clauses that filter on calculations
                        in the query result.
                      items:
                        properties:
                          key:
                            type: string
                          operation:
                            enum:
                              - eq
                              - neq
                              - gt
                              - gte
                              - lt
                              - lte
                            type: string
                          value:
                            type: number
                        required:
                          - key
                          - operation
                          - value
                        type: object
                      type: array
                    limit:
                      description: >-
                        Set a limit on the number of results / records returned
                        by the query
                      maximum: 100
                      minimum: 0
                      type: integer
                    needle:
                      description: Define an expression to search using full-text search.
                      properties:
                        isRegex:
                          type: boolean
                        matchCase:
                          type: boolean
                        value:
                          anyOf:
                            - type: string
                            - type: number
                            - type: boolean
                      required:
                        - value
                      type: object
                    orderBy:
                      description: >-
                        Configure the order of the results returned by the
                        query.
                      properties:
                        order:
                          description: Set the order of the results
                          enum:
                            - asc
                            - desc
                          type: string
                        value:
                          description: Configure which Calculation to order the results by.
                          type: string
                      required:
                        - value
                      type: object
                  type: object
                patternType:
                  enum:
                    - message
                    - error
                  type: string
                queryId:
                  type: string
                timeframe:
                  properties:
                    from:
                      type: number
                    to:
                      type: number
                  required:
                    - to
                    - from
                  type: object
                view:
                  default: calculations
                  enum:
                    - traces
                    - events
                    - calculations
                    - invocations
                    - requests
                    - patterns
                  type: string
              required:
                - queryId
                - timeframe
              type: object
        description: >-
          Query your observability events, requests, and traces. Build
          visualizations and identify insights.
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  errors:
                    items:
                      properties:
                        message:
                          type: string
                      required:
                        - message
                      type: object
                    type: array
                  messages:
                    items:
                      properties:
                        message:
                          enum:
                            - Successful request
                          type: string
                      required:
                        - message
                      type: object
                    type: array
                  result:
                    $ref: '#/components/schemas/workers-observability_query_results'
                  success:
                    enum:
                      - true
                    type: boolean
                required:
                  - messages
                  - success
                  - errors
                  - result
                type: object
          description: Successful request
        '401':
          content:
            application/json:
              schema:
                properties:
                  errors:
                    items:
                      properties:
                        detail:
                          type: string
                        message:
                          enum:
                            - Unauthorized
                          type: string
                      required:
                        - message
                      type: object
                    type: array
                  messages:
                    items:
                      properties:
                        message:
                          type: string
                      required:
                        - message
                      type: object
                    type: array
                  success:
                    enum:
                      - false
                    type: boolean
                required:
                  - errors
                  - success
                  - messages
                type: object
          description: Unauthorized
        '500':
          content:
            application/json:
              schema:
                properties:
                  errors:
                    items:
                      properties:
                        detail:
                          type: string
                        message:
                          enum:
                            - Internal error
                          type: string
                      required:
                        - message
                      type: object
                    type: array
                  messages:
                    items:
                      properties:
                        message:
                          type: string
                      required:
                        - message
                      type: object
                    type: array
                  success:
                    enum:
                      - false
                    type: boolean
                required:
                  - errors
                  - success
                  - messages
                type: object
          description: Internal error
      summary: Run a query
      tags:
        - Query run
      x-api-token-group:
        - Workers Observability Write
components:
  schemas:
    workers-observability_query_results:
      properties:
        calculations:
          items:
            properties:
              aggregates:
                items:
                  properties:
                    count:
                      type: number
                    groups:
                      items:
                        properties:
                          key:
                            type: string
                          value:
                            anyOf:
                              - type: string
                              - type: number
                              - type: boolean
                        required:
                          - key
                          - value
                        type: object
                      type: array
                    interval:
                      type: number
                    sampleInterval:
                      type: number
                    value:
                      type: number
                  required:
                    - value
                    - count
                    - interval
                    - sampleInterval
                  type: object
                type: array
              alias:
                type: string
              calculation:
                type: string
              series:
                items:
                  properties:
                    data:
                      items:
                        properties:
                          count:
                            type: number
                          firstSeen:
                            type: string
                          groups:
                            items:
                              properties:
                                key:
                                  type: string
                                value:
                                  anyOf:
                                    - type: string
                                    - type: number
                                    - type: boolean
                              required:
                                - key
                                - value
                              type: object
                            type: array
                          interval:
                            type: number
                          lastSeen:
                            type: string
                          sampleInterval:
                            type: number
                          value:
                            type: number
                        required:
                          - value
                          - count
                          - interval
                          - sampleInterval
                          - firstSeen
                          - lastSeen
                        type: object
                      type: array
                    time:
                      type: string
                  required:
                    - time
                    - data
                  type: object
                type: array
            required:
              - calculation
              - aggregates
              - series
            type: object
          type: array
        compare:
          items:
            properties:
              aggregates:
                items:
                  properties:
                    count:
                      type: number
                    groups:
                      items:
                        properties:
                          key:
                            type: string
                          value:
                            anyOf:
                              - type: string
                              - type: number
                              - type: boolean
                        required:
                          - key
                          - value
                        type: object
                      type: array
                    interval:
                      type: number
                    sampleInterval:
                      type: number
                    value:
                      type: number
                  required:
                    - value
                    - count
                    - interval
                    - sampleInterval
                  type: object
                type: array
              alias:
                type: string
              calculation:
                type: string
              series:
                items:
                  properties:
                    data:
                      items:
                        properties:
                          count:
                            type: number
                          firstSeen:
                            type: string
                          groups:
                            items:
                              properties:
                                key:
                                  type: string
                                value:
                                  anyOf:
                                    - type: string
                                    - type: number
                                    - type: boolean
                              required:
                                - key
                                - value
                              type: object
                            type: array
                          interval:
                            type: number
                          lastSeen:
                            type: string
                          sampleInterval:
                            type: number
                          value:
                            type: number
                        required:
                          - value
                          - count
                          - interval
                          - sampleInterval
                          - firstSeen
                          - lastSeen
                        type: object
                      type: array
                    time:
                      type: string
                  required:
                    - time
                    - data
                  type: object
                type: array
            required:
              - calculation
              - aggregates
              - series
            type: object
          type: array
        events:
          properties:
            count:
              type: number
            events:
              items:
                $ref: '#/components/schemas/workers-observability_telemetry_event'
              type: array
            fields:
              items:
                properties:
                  key:
                    type: string
                  type:
                    type: string
                required:
                  - key
                  - type
                type: object
              type: array
            series:
              items:
                properties:
                  data:
                    items:
                      properties:
                        aggregates:
                          properties:
                            _count:
                              deprecated: true
                              exclusiveMinimum: true
                              minimum: 0
                              type: integer
                            _firstSeen:
                              deprecated: true
                              type: string
                            _interval:
                              deprecated: true
                              exclusiveMinimum: true
                              minimum: 0
                              type: integer
                            _lastSeen:
                              deprecated: true
                              type: string
                            bin:
                              deprecated: true
                              type: object
                          required:
                            - _count
                            - _interval
                            - _firstSeen
                            - _lastSeen
                          type: object
                        count:
                          type: number
                        errors:
                          type: number
                        groups:
                          additionalProperties:
                            anyOf:
                              - type: string
                              - type: number
                              - type: boolean
                          description: Groups in the query results.
                          type: object
                        interval:
                          type: number
                        sampleInterval:
                          type: number
                      required:
                        - aggregates
                        - count
                        - interval
                        - sampleInterval
                      type: object
                    type: array
                  time:
                    type: string
                required:
                  - time
                  - data
                type: object
              type: array
          type: object
        invocations:
          additionalProperties:
            items:
              $ref: '#/components/schemas/workers-observability_telemetry_event'
            type: array
          type: object
        patterns:
          items:
            properties:
              count:
                type: number
              pattern:
                type: string
              series:
                items:
                  properties:
                    data:
                      properties:
                        count:
                          type: number
                        groups:
                          items:
                            properties:
                              key:
                                type: string
                              value:
                                anyOf:
                                  - type: string
                                  - type: number
                                  - type: boolean
                            required:
                              - key
                              - value
                            type: object
                          type: array
                        interval:
                          type: number
                        sampleInterval:
                          type: number
                        value:
                          type: number
                      required:
                        - value
                        - count
                        - interval
                        - sampleInterval
                      type: object
                    time:
                      type: string
                  required:
                    - time
                    - data
                  type: object
                type: array
              service:
                type: string
            required:
              - service
              - pattern
              - count
              - series
            type: object
          type: array
        run:
          $ref: '#/components/schemas/workers-observability_query_run'
        statistics:
          $ref: '#/components/schemas/workers-observability_performance_information'
      required:
        - run
        - statistics
      type: object
